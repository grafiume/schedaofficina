<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Scheda Officina · Nuova Grafica</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="icons/icon-192.png">
  <meta name="theme-color" content="#ff7f00">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- HEADER -->
  <header class="app-header">
    <div class="logo-row">
      <img src="logo-elip.jpg" alt="Logo" class="logo">
      <div class="brand">
        <h1>Scheda Officina</h1>
        <small class="muted">Nuova UI · ricerca esatta · multi‑device</small>
      </div>
      <div class="actions">
        <button id="btnHome" class="btn ghost">Home</button>
        <button id="btnSearchPage" class="btn ghost">Ricerca</button>
        <button id="btnNew" class="btn">Nuova scheda</button>
      </div>
    </div>
  </header>

  <!-- KPI BAR -->
  <section class="kpi-row" id="kpiRow">
    <div class="kpi" id="kpiTotCard">
      <div class="kpi-top">Totali</div>
      <div class="kpi-num" id="kpiTot">0</div>
    </div>
    <div class="kpi kpi-green" id="kpiAttesaCard">
      <div class="kpi-top">In attesa</div>
      <div class="kpi-num" id="kpiAttesa">0</div>
    </div>
    <div class="kpi kpi-orange" id="kpiLavCard">
      <div class="kpi-top">In lavorazione</div>
      <div class="kpi-num" id="kpiLav">0</div>
    </div>
    <div class="kpi kpi-gray" id="kpiChiuseCard">
      <div class="kpi-top">Completate/Chiuse</div>
      <div class="kpi-num" id="kpiChiuse">0</div>
    </div>
  </section>

  <!-- SEARCH PAGE -->
  <main class="container d-none" id="page-search">
    <h2>Ricerca</h2>
    <p class="muted">Ricerca <b>esatta</b>: confronto perfetto (senza wildcard). Maiuscole/minuscole e accenti ignorati.</p>

    <div class="search-row">
      <input id="q" class="input" placeholder="Valore esatto da cercare (cliente, descrizione, note, telefono, DDT…)" />
      <select id="qCol" class="input">
        <option value="auto">Auto (colonne principali)</option>
        <option value="cliente">Cliente</option>
        <option value="descrizione">Descrizione</option>
        <option value="note">Note</option>
        <option value="telefono">Telefono</option>
        <option value="ddt">DDT</option>
        <option value="marca">Marca</option>
        <option value="modello">Modello</option>
      </select>
      <button id="btnDoSearch" class="btn">Cerca</button>
      <button id="btnClearFilter" class="btn ghost">Rimuovi filtro</button>
    </div>

    <div id="activeFilterBox" class="pillbox d-none">
      <span id="activeFilterLabel" class="pill"></span>
      <span class="spacer"></span>
      <button id="btnBackHome" class="link">Torna alla Home</button>
    </div>

    <div id="list" class="card-list"></div>
  </main>

  <!-- HOME (LIST AUTO) -->
  <main class="container" id="page-home">
    <h2>Archivio</h2>
    <div id="listHome" class="card-list"></div>
  </main>

  <!-- DETAIL PANEL -->
  <aside id="detailPanel" class="detail-panel d-none">
    <div class="detail-head">
      <h3 id="detailTitle">Nuova scheda</h3>
      <div id="statusBadge" class="status-badge d-none">CHIUSA</div>
      <button class="btn ghost" id="btnCloseDetail">Chiudi</button>
    </div>
    <form id="frm" class="form">
      <div class="grid">
        <label>Cliente<input id="cliente" class="input"></label>
        <label>Telefono<input id="telefono" class="input"></label>
        <label>Marca<input id="marca" class="input"></label>
        <label>Modello<input id="modello" class="input"></label>
        <label>Descrizione<textarea id="descrizione" class="input" rows="2"></textarea></label>
        <label>Note<textarea id="note" class="input" rows="2"></textarea></label>
        <label>DDT<input id="ddt" class="input"></label>
        <label>Stato
          <select id="stato" class="input">
            <option>In attesa</option>
            <option>In lavorazione</option>
            <option>Completata</option>
          </select>
        </label>
        <label>Data apertura<input id="dataApertura" type="date" class="input"></label>
        <label>Data accettazione<input id="dataAccettazione" type="date" class="input"></label>
        <label>Data fine<input id="dataFine" type="date" class="input"></label>
        <label>Avanzamento %<input id="avanzamento" type="number" min="0" max="100" step="1" class="input"></label>
      </div>

      <div class="upload">
        <input type="file" id="photo" accept="image/*">
        <button type="button" id="btnUpload" class="btn ghost">Carica foto</button>
        <div id="uploadMsg" class="muted"></div>
      </div>

      <div class="form-actions">
        <button type="button" id="btnSave" class="btn">Salva</button>
        <button type="button" id="btnDelete" class="btn danger">Elimina</button>
      </div>
    </form>
  </aside>

  <footer class="app-footer">
    <small class="muted">© 2025 — UI by Graziano • Palette originale (arancio/verde/grigio)</small>
  </footer>

  <script src="config.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase-singleton.js"></script>
  <script src="app-supabase.js"></script>
  <script src="app-core.js"></script>
  <script>
    if ('serviceWorker' in navigator) {{ navigator.serviceWorker.register('service-worker.js'); }}
  </script>
</body>
</html>
